name: Verify Docker Compose (default profile)

on:
    push:
        branches: [main]
    pull_request:

jobs:
    compose-verify:
        name: Verify Docker Compose Setup
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v6

            - name: Run Docker Compose setup
              uses: adambirds/docker-compose-action@v1.5.0
              with:
                  compose-file: "./docker-compose.yml"
                  up-flags: "--build --wait"
                  down-flags: "--volumes"
              env:
                  BACKEND_PORT: 5175
                  DB_USERNAME: postgres
                  DB_PASSWORD: example
                  DB_HOST: localhost
                  DB_PORT: 5432
                  DB_NAME: postgres
                  BETTER_AUTH_SECRET: better-auth-secret-placeholder01
                  BETTER_AUTH_URL: http://localhost:5175
                  LANGFLOW_BASE_URL: https://sieve-flows.informatik.uni-ulm.de
                  LANGFLOW_API_KEY: langflow-api-key-placeholder
                  NEXT_PUBLIC_API_URL: http://localhost:5175

            - name: Verify backend health
              run: |
                  echo "Waiting for backend..."
                  sleep 5
                  curl -f http://localhost:5175/api/health || (docker compose logs && exit 1)

            - name: Verify frontend availability
              run: |
                  curl -f http://localhost:3000 || (docker compose logs && exit 1)
