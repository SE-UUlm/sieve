name: Verify Docker Compose (default profile)

on:
    push:
        branches: [main]
    pull_request:

jobs:
    compose-verify:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Run Docker Compose setup
              uses: adambirds/docker-compose-action@v1.5.0
              with:
                  compose-file: "./docker-compose.yml"
                  up-flags: "--build --wait"
                  down-flags: "--volumes"
              env:
                  # Optional, override secrets if needed
                  DB_PASSWORD: example
                  NEXT_PUBLIC_API_URL: http://localhost:5175

            - name: Verify backend health
              run: |
                  echo "Waiting for backend..."
                  sleep 5
                  curl -f http://localhost:5175/health || (docker compose logs && exit 1)

            - name: Verify frontend availability
              run: |
                  curl -f http://localhost:3000 || (docker compose logs && exit 1)
